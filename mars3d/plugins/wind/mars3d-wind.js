/**
 * Mars3D平台插件,支持气象 风向图 功能插件  mars3d-wind
 *
 * 版本信息：v3.6.18
 * 编译日期：2023-12-31 22:41:48
 * 版权所有：Copyright by 火星科技  http://mars3d.cn
 * 使用单位：免费公开版 ，2023-03-17
 */
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, (window.mars3d || require('mars3d'))) :
  typeof define === 'function' && define.amd ? define(['exports', 'mars3d'], factory) :
  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global["mars3d-wind"] = {}, global.mars3d));
})(this, (function (exports, mars3d) { 
'use strict';const _0x230669=_0x55d6;(function(_0x50fc6b,_0xd8430a){const _0x3e591b=_0x55d6,_0x4a1706=_0x50fc6b();while(!![]){try{const _0x9fdff9=parseInt(_0x3e591b(0x1b8))/0x1*(-parseInt(_0x3e591b(0x1c9))/0x2)+-parseInt(_0x3e591b(0x22b))/0x3+parseInt(_0x3e591b(0x1d9))/0x4*(parseInt(_0x3e591b(0x19a))/0x5)+parseInt(_0x3e591b(0x249))/0x6*(parseInt(_0x3e591b(0x23f))/0x7)+-parseInt(_0x3e591b(0x20f))/0x8+parseInt(_0x3e591b(0x1cf))/0x9*(-parseInt(_0x3e591b(0x1ca))/0xa)+parseInt(_0x3e591b(0x20c))/0xb;if(_0x9fdff9===_0xd8430a)break;else _0x4a1706['push'](_0x4a1706['shift']());}catch(_0x4086cd){_0x4a1706['push'](_0x4a1706['shift']());}}}(_0x28dc,0x923c5));function _interopNamespace(_0x2391ff){const _0x4e97a9=_0x55d6;if(_0x2391ff&&_0x2391ff['__esModule'])return _0x2391ff;var _0x1c5f24=Object['create'](null);return _0x2391ff&&Object['keys'](_0x2391ff)[_0x4e97a9(0x26d)](function(_0x43590c){const _0x4b7417=_0x4e97a9;if(_0x43590c!==_0x4b7417(0x1e8)){var _0x339970=Object[_0x4b7417(0x19b)](_0x2391ff,_0x43590c);Object[_0x4b7417(0x24c)](_0x1c5f24,_0x43590c,_0x339970[_0x4b7417(0x1b0)]?_0x339970:{'enumerable':!![],'get':function(){return _0x2391ff[_0x43590c];}});}}),_0x1c5f24[_0x4e97a9(0x1e8)]=_0x2391ff,_0x1c5f24;}var mars3d__namespace=_interopNamespace(mars3d);const Cesium$7=mars3d__namespace[_0x230669(0x1ba)];function getU(_0x444398,_0x1fefe0){const _0x1a4547=_0x444398*Math['cos'](Cesium$7['Math']['toRadians'](_0x1fefe0));return _0x1a4547;}function getV(_0x2d0269,_0x53dbdf){const _0x451282=_0x2d0269*Math['sin'](Cesium$7['Math']['toRadians'](_0x53dbdf));return _0x451282;}function getSpeed(_0x19d58c,_0x481e68){const _0x82836e=_0x230669,_0x1d1af3=Math['sqrt'](Math[_0x82836e(0x235)](_0x19d58c,0x2)+Math[_0x82836e(0x235)](_0x481e68,0x2));return _0x1d1af3;}function getDirection(_0x5e67fc,_0x1ee24b){const _0x2406eb=_0x230669;let _0x678e52=Cesium$7['Math'][_0x2406eb(0x256)](Math['atan2'](_0x1ee24b,_0x5e67fc));return _0x678e52+=_0x678e52<0x0?0x168:0x0,_0x678e52;}var WindUtil={'__proto__':null,'getU':getU,'getV':getV,'getSpeed':getSpeed,'getDirection':getDirection};const Cesium$6=mars3d__namespace['Cesium'];function _0x28dc(){const _0x5645a1=['drawingBufferHeight','TextureMinificationFilter','createRawRenderState','screen','setData','get','age','createRenderingFramebuffers','updatePosition','init','colors','vmin','canvasHeight','53613HTakgd','strokeStyle','Cesium','zIndex','preRender','_mountedHook','max','destroy','fromDegrees','animateFrame','__esModule','nextParticlesSpeed','mouse_move','lon','_onMap_preRenderEvent','_onMapWhellEvent','canvas','42oOYTdg','10SsrZeL','TextureMagnificationFilter','PixelDatatype','_map','STATIC_DRAW','8238681yzkGSI','TWO_PI','outputTexture','clientWidth','ellipsoid','height','particlesComputing','setDate','PrimitiveType','grid','24wJaSvW','now','trails','xmax','defined','umin','canvasResize','frameTime','visible','windField','currentParticlesPosition','_randomParticle','randomBetween','nextTrails','uniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20lengthOfLonLat(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20unit\x20conversion:\x20meters\x20->\x20longitude\x20latitude\x20degrees\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_system#Length_of_a_degree\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20Calculate\x20the\x20length\x20of\x20a\x20degree\x20of\x20latitude\x20and\x20longitude\x20in\x20meters\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x0a\x20\x20\x20\x20float\x20term1\x20=\x20111132.92;\x0a\x20\x20\x20\x20float\x20term2\x20=\x20559.82\x20*\x20cos(2.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term3\x20=\x201.175\x20*\x20cos(4.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term4\x20=\x200.0023\x20*\x20cos(6.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20latLength\x20=\x20term1\x20-\x20term2\x20+\x20term3\x20-\x20term4;\x0a\x0a\x20\x20\x20\x20float\x20term5\x20=\x20111412.84\x20*\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20term6\x20=\x2093.5\x20*\x20cos(3.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term7\x20=\x200.118\x20*\x20cos(5.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20longLength\x20=\x20term5\x20-\x20term6\x20+\x20term7;\x0a\x0a\x20\x20\x20\x20return\x20vec2(longLength,\x20latLength);\x0a}\x0a\x0avoid\x20updatePosition(vec3\x20lonLatLev,\x20vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec2\x20lonLatLength\x20=\x20lengthOfLonLat(lonLatLev);\x0a\x20\x20\x20\x20float\x20u\x20=\x20speed.x\x20/\x20lonLatLength.x;\x0a\x20\x20\x20\x20float\x20v\x20=\x20speed.y\x20/\x20lonLatLength.y;\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20vec3\x20windVectorInLonLatLev\x20=\x20vec3(u,\x20v,\x20w);\x0a\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20lonLatLev\x20+\x20windVectorInLonLatLev;\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20speed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20updatePosition(lonLatLev,\x20speed);\x0a}\x0a','default','off','VertexArray','PI_OVER_TWO','Color','ComponentDatatype','ShaderSource','all','EllipsoidalOccluder','show','destination-in','ceil','setOptions','_colorRamp','lev','camera','length','ColorRamp','attributeLocations','getUVByXY','isDestroyed','pixelSize','particlesRendering','moveTo','mod','GeometryAttribute','keys','Compute','register','min','particlesNumber','LayerUtil','cancelAnimationFrame','lat','currentTrailsDepth','BoundingSphere','21800658DFXoYv','fromGeometry','Cartesian3','1221536DBKbKD','resize','PI_OVER_THREE','update','segmentsDepth','primitives','randomizeParticles','lng','push','createCommand','ymin','in\x20vec2\x20st;\x0a//\x20it\x20is\x20not\x20normal\x20itself,\x20but\x20used\x20to\x20control\x20normal\x0ain\x20vec3\x20normal;\x20//\x20(point\x20to\x20use,\x20offset\x20sign,\x20not\x20used\x20component)\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x0auniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20postProcessingSpeed;\x0a\x0auniform\x20float\x20particleHeight;\x0a\x0auniform\x20float\x20aspect;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20lineWidth;\x0a\x0aout\x20float\x20speedNormalization;\x0a\x0avec3\x20convertCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20WGS84\x20(lon,\x20lat,\x20lev)\x20->\x20ECEF\x20(x,\x20y,\x20z)\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_conversion#From_geodetic_to_ECEF_coordinates\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20WGS\x2084\x20geometric\x20constants\x0a\x20\x20\x20\x20float\x20a\x20=\x206378137.0;\x20//\x20Semi-major\x20axis\x0a\x20\x20\x20\x20float\x20b\x20=\x206356752.3142;\x20//\x20Semi-minor\x20axis\x0a\x20\x20\x20\x20float\x20e2\x20=\x206.69437999014e-3;\x20//\x20First\x20eccentricity\x20squared\x0a\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x20\x20\x20\x20float\x20longitude\x20=\x20radians(lonLatLev.x);\x0a\x0a\x20\x20\x20\x20float\x20cosLat\x20=\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20sinLat\x20=\x20sin(latitude);\x0a\x20\x20\x20\x20float\x20cosLon\x20=\x20cos(longitude);\x0a\x20\x20\x20\x20float\x20sinLon\x20=\x20sin(longitude);\x0a\x0a\x20\x20\x20\x20float\x20N_Phi\x20=\x20a\x20/\x20sqrt(1.0\x20-\x20e2\x20*\x20sinLat\x20*\x20sinLat);\x0a\x20\x20\x20\x20float\x20h\x20=\x20particleHeight;\x20//\x20it\x20should\x20be\x20high\x20enough\x20otherwise\x20the\x20particle\x20may\x20not\x20pass\x20the\x20terrain\x20depth\x20test\x0a\x0a\x20\x20\x20\x20vec3\x20cartesian\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20cartesian.x\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20cosLon;\x0a\x20\x20\x20\x20cartesian.y\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20sinLon;\x0a\x20\x20\x20\x20cartesian.z\x20=\x20((b\x20*\x20b)\x20/\x20(a\x20*\x20a)\x20*\x20N_Phi\x20+\x20h)\x20*\x20sinLat;\x0a\x20\x20\x20\x20return\x20cartesian;\x0a}\x0a\x0avec4\x20calcProjectedCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20the\x20range\x20of\x20longitude\x20in\x20Cesium\x20is\x20[-180,\x20180]\x20but\x20the\x20range\x20of\x20longitude\x20in\x20the\x20NetCDF\x20file\x20is\x20[0,\x20360]\x0a\x20\x20\x20\x20//\x20[0,\x20180]\x20is\x20corresponding\x20to\x20[0,\x20180]\x20and\x20[180,\x20360]\x20is\x20corresponding\x20to\x20[-180,\x200]\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x\x20+\x20180.0,\x20360.0)\x20-\x20180.0;\x0a\x20\x20\x20\x20vec3\x20particlePosition\x20=\x20convertCoordinate(lonLatLev);\x0a\x20\x20\x20\x20vec4\x20projectedCoordinate\x20=\x20czm_modelViewProjection\x20*\x20vec4(particlePosition,\x201.0);\x0a\x20\x20\x20\x20return\x20projectedCoordinate;\x0a}\x0a\x0avec4\x20calcOffset(vec4\x20currentProjectedCoordinate,\x20vec4\x20nextProjectedCoordinate,\x20float\x20offsetSign)\x20{\x0a\x20\x20\x20\x20vec2\x20aspectVec2\x20=\x20vec2(aspect,\x201.0);\x0a\x20\x20\x20\x20vec2\x20currentXY\x20=\x20(currentProjectedCoordinate.xy\x20/\x20currentProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x20\x20\x20\x20vec2\x20nextXY\x20=\x20(nextProjectedCoordinate.xy\x20/\x20nextProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x0a\x20\x20\x20\x20float\x20offsetLength\x20=\x20lineWidth\x20/\x202.0;\x0a\x20\x20\x20\x20vec2\x20direction\x20=\x20normalize(nextXY\x20-\x20currentXY);\x0a\x20\x20\x20\x20vec2\x20normalVector\x20=\x20vec2(-direction.y,\x20direction.x);\x0a\x20\x20\x20\x20normalVector.x\x20=\x20normalVector.x\x20/\x20aspect;\x0a\x20\x20\x20\x20normalVector\x20=\x20offsetLength\x20*\x20normalVector;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20vec4(offsetSign\x20*\x20normalVector,\x200.0,\x200.0);\x0a\x20\x20\x20\x20return\x20offset;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec2\x20particleIndex\x20=\x20st;\x0a\x0a\x20\x20\x20\x20vec3\x20currentPosition\x20=\x20texture(currentParticlesPosition,\x20particleIndex).rgb;\x0a\x20\x20\x20\x20vec4\x20nextPosition\x20=\x20texture(postProcessingPosition,\x20particleIndex);\x0a\x0a\x20\x20\x20\x20vec4\x20currentProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20vec4\x20nextProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(nextPosition.w\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(nextPosition.xyz);\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20float\x20pointToUse\x20=\x20normal.x;\x20//\x20-1\x20is\x20currentProjectedCoordinate\x20and\x20+1\x20is\x20nextProjectedCoordinate\x0a\x20\x20\x20\x20float\x20offsetSign\x20=\x20normal.y;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20pixelSize\x20*\x20calcOffset(currentProjectedCoordinate,\x20nextProjectedCoordinate,\x20offsetSign);\x0a\x20\x20\x20\x20if\x20(pointToUse\x20<\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20currentProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20nextProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20speedNormalization\x20=\x20texture(postProcessingSpeed,\x20particleIndex).a;\x0a}\x0a','_speedRate','applyViewerParameters','commandType','xmin','createSegmentsGeometry','globe','postProcessingSpeed','options','mouseHidden','EventType','CanvasWindLayer','getColorTexture','reverse','_createCanvas','Sampler','BufferUsage','184338fPRBnb','WindLayer','RenderState','scene','textures','beginPath','nextParticlesPosition','destroyObject','particlesTextureSize','postProcessingPosition','pow','once','vertexArray','Cartesian2','pointer-events','getWind','round','postMessage','speed','rawRenderState','232617PRBgWH','Math','maxAge','dropRateBump','canvasWind','add','_bilinearInterpolation','windData','ZERO','lonRange','102cKqoHz','blending','currentTrailsColor','defineProperty','isInExtent','particleSystem','pointerEvents','segmentsColor','OPAQUE','LUMINANCE','remove','particleHeight','maxParticles','toDegrees','wheel','speedRate','dimensions','createWindTextures','data','canvasContext','particlesWind','tlng','_updateIng','SCENE3D','updateViewerParameters','mouseMove','_data','umax','SceneMode','_calcUV','style','sqrt','positionWC','udata','getOptions','_tomap','forEach','addEventListener','vertexShaderSource','depthTest','worker','getColor','cols','0px','color','ymax','_calc_speedRate','Framebuffer','Draw','lineTo','vdata','red','framebuffers','commandToExecute','destroyParticlesTextures','_onMouseMoveEvent','framebuffer','_onMouseUpEvent','TRIANGLES','PrimitiveCollection','getRandomLatLng','layer','uniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20randomParticle\x20=\x20texture(postProcessingPosition,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20vec4\x20particleSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x0a\x20\x20\x20\x20if\x20(randomParticle.a\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20particleSpeed;\x0a\x20\x20\x20\x20}\x0a}\x0a','viewerParameters','UNSIGNED_INT','createTexture','segments','array','geometry','mouse_down','clearCommand','FLOAT','particlesTextures','lineWidth','rows','_onMouseDownEvent','256330IUWVAz','getOwnPropertyDescriptor','createParticlesTextures','refreshTimer','container','IDENTITY','latRange','random','uniformMap','drawingBufferWidth','GeometryAttributes','_drawLines','addPrimitives','in\x20vec3\x20position;\x0ain\x20vec2\x20st;\x0a\x0aout\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20textureCoordinate\x20=\x20st;\x0a\x20\x20\x20\x20gl_Position\x20=\x20vec4(position,\x201.0);\x0a}\x0a','_removedHook','createRenderingTextures','context'];_0x28dc=function(){return _0x5645a1;};return _0x28dc();}class CustomPrimitive{constructor(_0x29aca0){const _0x1a035b=_0x230669;this[_0x1a035b(0x21d)]=_0x29aca0[_0x1a035b(0x21d)],this[_0x1a035b(0x28d)]=_0x29aca0['geometry'],this[_0x1a035b(0x1fa)]=_0x29aca0['attributeLocations'],this['primitiveType']=_0x29aca0['primitiveType'],this['uniformMap']=_0x29aca0[_0x1a035b(0x1a2)],this['vertexShaderSource']=_0x29aca0[_0x1a035b(0x26f)],this['fragmentShaderSource']=_0x29aca0['fragmentShaderSource'],this['rawRenderState']=_0x29aca0[_0x1a035b(0x23e)],this['framebuffer']=_0x29aca0['framebuffer'],this['outputTexture']=_0x29aca0['outputTexture'],this['autoClear']=_0x29aca0['autoClear']??![],this['preExecute']=_0x29aca0['preExecute'],this[_0x1a035b(0x1f1)]=!![],this['commandToExecute']=undefined,this[_0x1a035b(0x28f)]=undefined,this['autoClear']&&(this[_0x1a035b(0x28f)]=new Cesium$6['ClearCommand']({'color':new Cesium$6[(_0x1a035b(0x1ec))](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':this[_0x1a035b(0x281)],'pass':Cesium$6['Pass'][_0x1a035b(0x251)]}));}[_0x230669(0x218)](_0x1ff6d2){const _0xf5d04e=_0x230669;switch(this['commandType']){case _0xf5d04e(0x279):{const _0x2cb354=Cesium$6['VertexArray']['fromGeometry']({'context':_0x1ff6d2,'geometry':this['geometry'],'attributeLocations':this[_0xf5d04e(0x1fa)],'bufferUsage':Cesium$6['BufferUsage']['STATIC_DRAW']}),_0x1e879f=Cesium$6['ShaderProgram']['fromCache']({'context':_0x1ff6d2,'attributeLocations':this['attributeLocations'],'vertexShaderSource':this['vertexShaderSource'],'fragmentShaderSource':this['fragmentShaderSource']}),_0x47af15=Cesium$6[_0xf5d04e(0x22d)]['fromCache'](this['rawRenderState']);return new Cesium$6['DrawCommand']({'primitiveType':this['primitiveType'],'shaderProgram':_0x1e879f,'vertexArray':_0x2cb354,'modelMatrix':Cesium$6['Matrix4'][_0xf5d04e(0x19f)],'renderState':_0x47af15,'uniformMap':this['uniformMap'],'castShadows':![],'receiveShadows':![],'framebuffer':this['framebuffer'],'pass':Cesium$6['Pass']['OPAQUE'],'pickOnly':!![],'owner':this});}case _0xf5d04e(0x203):{return new Cesium$6['ComputeCommand']({'owner':this,'fragmentShaderSource':this['fragmentShaderSource'],'uniformMap':this['uniformMap'],'outputTexture':this['outputTexture'],'persists':!![]});}}}['setGeometry'](_0x2eedb0,_0x53c51c){const _0x3f1e63=_0x230669;this['geometry']=_0x53c51c;const _0x5ab664=Cesium$6[_0x3f1e63(0x1ea)][_0x3f1e63(0x20d)]({'context':_0x2eedb0,'geometry':this[_0x3f1e63(0x28d)],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6[_0x3f1e63(0x22a)][_0x3f1e63(0x1ce)]});this[_0x3f1e63(0x27e)][_0x3f1e63(0x237)]=_0x5ab664;}['update'](_0x513334){const _0x22dfe0=_0x230669;if(!this['show'])return;if(_0x513334['mode']!==Cesium$6[_0x22dfe0(0x265)][_0x22dfe0(0x260)])return;!Cesium$6['defined'](this['commandToExecute'])&&(this['commandToExecute']=this[_0x22dfe0(0x218)](_0x513334['context'])),Cesium$6[_0x22dfe0(0x1dd)](this['preExecute'])&&this['preExecute'](),Cesium$6['defined'](this['clearCommand'])&&_0x513334['commandList']['push'](this[_0x22dfe0(0x28f)]),_0x513334['commandList']['push'](this['commandToExecute']);}[_0x230669(0x1fc)](){return![];}['destroy'](){const _0x2685c9=_0x230669;if(this['clearCommand']){var _0x3bdb06,_0x5e95a0;(_0x3bdb06=this['clearCommand'])!==null&&_0x3bdb06!==void 0x0&&_0x3bdb06['vertexArray']&&this['clearCommand']['vertexArray'][_0x2685c9(0x1bf)](),(_0x5e95a0=this[_0x2685c9(0x28f)])!==null&&_0x5e95a0!==void 0x0&&_0x5e95a0['shaderProgram']&&this['clearCommand']['shaderProgram'][_0x2685c9(0x1bf)](),delete this['clearCommand'];}return this[_0x2685c9(0x27e)]&&(this['commandToExecute'][_0x2685c9(0x237)]&&this['commandToExecute']['vertexArray']['destroy'](),this[_0x2685c9(0x27e)]['shaderProgram']&&this['commandToExecute']['shaderProgram']['destroy'](),delete this[_0x2685c9(0x27e)]),Cesium$6[_0x2685c9(0x232)](this);}}const Cesium$5=mars3d__namespace['Cesium'],Util=(function(){const _0x50e188=function(){const _0x5b91cd=_0x55d6,_0x4a3450=new Cesium$5['Geometry']({'attributes':new Cesium$5[(_0x5b91cd(0x1a4))]({'position':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5[_0x5b91cd(0x1ed)][_0x5b91cd(0x290)],'componentsPerAttribute':0x3,'values':new Float32Array([-0x1,-0x1,0x0,0x1,-0x1,0x0,0x1,0x1,0x0,-0x1,0x1,0x0])}),'st':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5['ComponentDatatype'][_0x5b91cd(0x290)],'componentsPerAttribute':0x2,'values':new Float32Array([0x0,0x0,0x1,0x0,0x1,0x1,0x0,0x1])})}),'indices':new Uint32Array([0x3,0x2,0x0,0x0,0x2,0x1])});return _0x4a3450;},_0x9d70e8=function(_0x488c53,_0x3e283e){const _0x4585ae=_0x55d6;if(Cesium$5[_0x4585ae(0x1dd)](_0x3e283e)){const _0x8bbafb={};_0x8bbafb['arrayBufferView']=_0x3e283e,_0x488c53['source']=_0x8bbafb;}const _0x5cecbe=new Cesium$5['Texture'](_0x488c53);return _0x5cecbe;},_0x3ce1fa=function(_0x9e285f,_0x24540e,_0x209512){const _0x46737b=_0x55d6,_0x5f3131=new Cesium$5[(_0x46737b(0x278))]({'context':_0x9e285f,'colorTextures':[_0x24540e],'depthTexture':_0x209512});return _0x5f3131;},_0x361e4e=function(_0x262b86){const _0x3f5612=_0x55d6,_0x8eca93=!![],_0x18bd86=![],_0x1f0440={'viewport':_0x262b86['viewport'],'depthTest':_0x262b86[_0x3f5612(0x270)],'depthMask':_0x262b86['depthMask'],'blending':_0x262b86[_0x3f5612(0x24a)]},_0x38dc62=Cesium$5['Appearance']['getDefaultRenderState'](_0x8eca93,_0x18bd86,_0x1f0440);return _0x38dc62;},_0x25419a=function(_0x2f3a74){const _0x5146b1=_0x55d6,_0x5e5a99={},_0x46da66=Cesium$5['Math'][_0x5146b1(0x200)](_0x2f3a74['west'],Cesium$5['Math']['TWO_PI']),_0x3d4d4d=Cesium$5['Math']['mod'](_0x2f3a74['east'],Cesium$5[_0x5146b1(0x240)][_0x5146b1(0x1d0)]),_0x3aa97f=_0x2f3a74['width'];let _0x565fda,_0x3f63f0;_0x3aa97f>Cesium$5[_0x5146b1(0x240)]['THREE_PI_OVER_TWO']?(_0x565fda=0x0,_0x3f63f0=Cesium$5['Math']['TWO_PI']):_0x3d4d4d-_0x46da66<_0x3aa97f?(_0x565fda=_0x46da66,_0x3f63f0=_0x46da66+_0x3aa97f):(_0x565fda=_0x46da66,_0x3f63f0=_0x3d4d4d);_0x5e5a99['lon']={'min':Cesium$5['Math'][_0x5146b1(0x256)](_0x565fda),'max':Cesium$5[_0x5146b1(0x240)]['toDegrees'](_0x3f63f0)};const _0x1f592d=_0x2f3a74['south'],_0x1d809b=_0x2f3a74['north'],_0x251757=_0x2f3a74['height'],_0x23b17e=_0x251757>Cesium$5[_0x5146b1(0x240)]['PI']/0xc?_0x251757/0x2:0x0;let _0x257b13=Cesium$5['Math']['clampToLatitudeRange'](_0x1f592d-_0x23b17e),_0x6aa188=Cesium$5['Math']['clampToLatitudeRange'](_0x1d809b+_0x23b17e);return _0x257b13<-Cesium$5[_0x5146b1(0x240)]['PI_OVER_THREE']&&(_0x257b13=-Cesium$5['Math']['PI_OVER_TWO']),_0x6aa188>Cesium$5['Math'][_0x5146b1(0x211)]&&(_0x6aa188=Cesium$5['Math'][_0x5146b1(0x1eb)]),_0x5e5a99['lat']={'min':Cesium$5['Math']['toDegrees'](_0x257b13),'max':Cesium$5['Math'][_0x5146b1(0x256)](_0x6aa188)},_0x5e5a99;};return{'getFullscreenQuad':_0x50e188,'createTexture':_0x9d70e8,'createFramebuffer':_0x3ce1fa,'createRawRenderState':_0x361e4e,'viewRectangleToLonLatRange':_0x25419a};}());var segmentDraw_vert=_0x230669(0x21a),segmentDraw_frag='uniform\x20sampler2D\x20colorTable;\x0a\x0ain\x20float\x20speedNormalization;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20out_FragColor\x20=\x20texture(colorTable,\x20vec2(speedNormalization,\x200.0));\x0a}\x0a',fullscreen_vert=_0x230669(0x1a7),trailDraw_frag='uniform\x20sampler2D\x20segmentsColorTexture;\x0auniform\x20sampler2D\x20segmentsDepthTexture;\x0a\x0auniform\x20sampler2D\x20currentTrailsColor;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0auniform\x20float\x20fadeOpacity;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20pointsColor\x20=\x20texture(segmentsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(currentTrailsColor,\x20textureCoordinate);\x0a\x0a\x20\x20\x20\x20trailsColor\x20=\x20floor(fadeOpacity\x20*\x20255.0\x20*\x20trailsColor)\x20/\x20255.0;\x20//\x20make\x20sure\x20the\x20trailsColor\x20will\x20be\x20strictly\x20decreased\x0a\x0a\x20\x20\x20\x20float\x20pointsDepth\x20=\x20texture(segmentsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(pointsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20pointsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20trailsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20gl_FragDepth\x20=\x20min(pointsDepth,\x20trailsDepth);\x0a}\x0a',screenDraw_frag='uniform\x20sampler2D\x20trailsColorTexture;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(trailsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20trailsColor;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x0a}\x0a';const Cesium$4=mars3d__namespace['Cesium'];class ParticlesRendering{constructor(_0x492f1f,_0x340c24,_0x1b6c0f,_0x12b16a,_0x55ddf6){const _0x417038=_0x230669;this[_0x417038(0x1a9)](_0x492f1f,_0x340c24,_0x1b6c0f['colors']),this[_0x417038(0x1b2)](_0x492f1f),this['createRenderingPrimitives'](_0x492f1f,_0x1b6c0f,_0x12b16a,_0x55ddf6);}['createRenderingTextures'](_0x5da227,_0x12027d,_0x3df394){const _0x302aa4=_0x230669,_0x509ee9={'context':_0x5da227,'width':_0x5da227['drawingBufferWidth'],'height':_0x5da227['drawingBufferHeight'],'pixelFormat':Cesium$4['PixelFormat']['RGBA'],'pixelDatatype':Cesium$4['PixelDatatype']['UNSIGNED_BYTE']},_0x4ee42c={'context':_0x5da227,'width':_0x5da227['drawingBufferWidth'],'height':_0x5da227['drawingBufferHeight'],'pixelFormat':Cesium$4['PixelFormat']['DEPTH_COMPONENT'],'pixelDatatype':Cesium$4['PixelDatatype'][_0x302aa4(0x289)]},_0x1db3ea=_0x3df394['length'],_0x145db6=new Float32Array(_0x1db3ea*0x3);for(let _0x437731=0x0;_0x437731<_0x1db3ea;_0x437731++){const _0x4f585e=Cesium$4[_0x302aa4(0x1ec)]['fromCssColorString'](_0x3df394[_0x437731]);_0x145db6[0x3*_0x437731]=_0x4f585e[_0x302aa4(0x27c)],_0x145db6[0x3*_0x437731+0x1]=_0x4f585e['green'],_0x145db6[0x3*_0x437731+0x2]=_0x4f585e['blue'];}const _0x561de2={'context':_0x5da227,'width':_0x1db3ea,'height':0x1,'pixelFormat':Cesium$4['PixelFormat']['RGB'],'pixelDatatype':Cesium$4['PixelDatatype']['FLOAT'],'sampler':new Cesium$4['Sampler']({'minificationFilter':Cesium$4[_0x302aa4(0x1ac)]['LINEAR'],'magnificationFilter':Cesium$4['TextureMagnificationFilter']['LINEAR']})};this[_0x302aa4(0x22f)]={'segmentsColor':Util['createTexture'](_0x509ee9),'segmentsDepth':Util['createTexture'](_0x4ee42c),'currentTrailsColor':Util['createTexture'](_0x509ee9),'currentTrailsDepth':Util['createTexture'](_0x4ee42c),'nextTrailsColor':Util['createTexture'](_0x509ee9),'nextTrailsDepth':Util['createTexture'](_0x4ee42c),'colorTable':Util['createTexture'](_0x561de2,_0x145db6)};}['createRenderingFramebuffers'](_0x4da521){const _0x529083=_0x230669;this['framebuffers']={'segments':Util['createFramebuffer'](_0x4da521,this[_0x529083(0x22f)][_0x529083(0x250)],this[_0x529083(0x22f)][_0x529083(0x213)]),'currentTrails':Util['createFramebuffer'](_0x4da521,this[_0x529083(0x22f)][_0x529083(0x24b)],this[_0x529083(0x22f)][_0x529083(0x20a)]),'nextTrails':Util['createFramebuffer'](_0x4da521,this[_0x529083(0x22f)]['nextTrailsColor'],this['textures']['nextTrailsDepth'])};}[_0x230669(0x21f)](_0x41c37e){const _0x565136=_0x230669,_0x434b71=0x4;let _0x2234d6=[];for(let _0x406822=0x0;_0x406822<_0x41c37e['particlesTextureSize'];_0x406822++){for(let _0x42229f=0x0;_0x42229f<_0x41c37e['particlesTextureSize'];_0x42229f++){for(let _0x129d10=0x0;_0x129d10<_0x434b71;_0x129d10++){_0x2234d6['push'](_0x406822/_0x41c37e['particlesTextureSize']),_0x2234d6['push'](_0x42229f/_0x41c37e[_0x565136(0x233)]);}}}_0x2234d6=new Float32Array(_0x2234d6);let _0x39360b=[];const _0x860c01=[-0x1,0x1],_0x5c4a10=[-0x1,0x1];for(let _0x139098=0x0;_0x139098<_0x41c37e[_0x565136(0x255)];_0x139098++){for(let _0x3696e5=0x0;_0x3696e5<_0x434b71/0x2;_0x3696e5++){for(let _0x2a8c40=0x0;_0x2a8c40<_0x434b71/0x2;_0x2a8c40++){_0x39360b[_0x565136(0x217)](_0x860c01[_0x3696e5]),_0x39360b[_0x565136(0x217)](_0x5c4a10[_0x2a8c40]),_0x39360b['push'](0x0);}}}_0x39360b=new Float32Array(_0x39360b);const _0x463d2c=0x6*_0x41c37e['maxParticles'],_0x383366=new Uint32Array(_0x463d2c);for(let _0x2f4be9=0x0,_0x3dece0=0x0,_0x24c003=0x0;_0x2f4be9<_0x41c37e['maxParticles'];_0x2f4be9++){_0x383366[_0x3dece0++]=_0x24c003+0x0,_0x383366[_0x3dece0++]=_0x24c003+0x1,_0x383366[_0x3dece0++]=_0x24c003+0x2,_0x383366[_0x3dece0++]=_0x24c003+0x2,_0x383366[_0x3dece0++]=_0x24c003+0x1,_0x383366[_0x3dece0++]=_0x24c003+0x3,_0x24c003+=0x4;}const _0xd91a6c=new Cesium$4['Geometry']({'attributes':new Cesium$4[(_0x565136(0x1a4))]({'st':new Cesium$4[(_0x565136(0x201))]({'componentDatatype':Cesium$4['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x2,'values':_0x2234d6}),'normal':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4[_0x565136(0x1ed)]['FLOAT'],'componentsPerAttribute':0x3,'values':_0x39360b})}),'indices':_0x383366});return _0xd91a6c;}['createRenderingPrimitives'](_0x195bbe,_0x39fcdd,_0x17dbb1,_0x4cf646){const _0x12eabc=_0x230669,_0x2d47ca=this;this['primitives']={'segments':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'st':0x0,'normal':0x1},'geometry':this[_0x12eabc(0x21f)](_0x39fcdd),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'currentParticlesPosition':function(){return _0x4cf646['particlesTextures']['currentParticlesPosition'];},'postProcessingPosition':function(){const _0x2a0395=_0x12eabc;return _0x4cf646[_0x2a0395(0x291)]['postProcessingPosition'];},'postProcessingSpeed':function(){const _0x13ff07=_0x12eabc;return _0x4cf646[_0x13ff07(0x291)]['postProcessingSpeed'];},'colorTable':function(){return _0x2d47ca['textures']['colorTable'];},'aspect':function(){const _0x9d8538=_0x12eabc;return _0x195bbe[_0x9d8538(0x1a3)]/_0x195bbe[_0x9d8538(0x1ab)];},'pixelSize':function(){const _0x253a5c=_0x12eabc;return _0x17dbb1[_0x253a5c(0x1fd)];},'lineWidth':function(){return _0x39fcdd['lineWidth'];},'particleHeight':function(){const _0x432983=_0x12eabc;return _0x39fcdd[_0x432983(0x254)];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_vert]}),'fragmentShaderSource':new Cesium$4[(_0x12eabc(0x1ee))]({'sources':[segmentDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![]},'depthMask':!![]}),'framebuffer':this['framebuffers'][_0x12eabc(0x28b)],'autoClear':!![]}),'trails':new CustomPrimitive({'commandType':_0x12eabc(0x279),'attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4['PrimitiveType'][_0x12eabc(0x283)],'uniformMap':{'segmentsColorTexture':function(){return _0x2d47ca['textures']['segmentsColor'];},'segmentsDepthTexture':function(){return _0x2d47ca['textures']['segmentsDepth'];},'currentTrailsColor':function(){const _0x966711=_0x12eabc;return _0x2d47ca['framebuffers']['currentTrails'][_0x966711(0x226)](0x0);},'trailsDepthTexture':function(){return _0x2d47ca['framebuffers']['currentTrails']['depthTexture'];},'fadeOpacity':function(){return _0x39fcdd['fadeOpacity'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[trailDraw_frag]}),'rawRenderState':Util[_0x12eabc(0x1ad)]({'viewport':undefined,'depthTest':{'enabled':!![],'func':Cesium$4['DepthFunction']['ALWAYS']},'depthMask':!![]}),'framebuffer':this['framebuffers']['nextTrails'],'autoClear':!![],'preExecute':function(){const _0x5babe3=_0x12eabc,_0xa2074e=_0x2d47ca['framebuffers']['currentTrails'];_0x2d47ca['framebuffers']['currentTrails']=_0x2d47ca['framebuffers']['nextTrails'],_0x2d47ca['framebuffers']['nextTrails']=_0xa2074e,_0x2d47ca['primitives']['trails'][_0x5babe3(0x27e)]['framebuffer']=_0x2d47ca['framebuffers'][_0x5babe3(0x1e6)],_0x2d47ca['primitives'][_0x5babe3(0x1db)][_0x5babe3(0x28f)]['framebuffer']=_0x2d47ca['framebuffers']['nextTrails'];}}),'screen':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4[_0x12eabc(0x1d7)][_0x12eabc(0x283)],'uniformMap':{'trailsColorTexture':function(){return _0x2d47ca['framebuffers']['nextTrails']['getColorTexture'](0x0);},'trailsDepthTexture':function(){return _0x2d47ca['framebuffers']['nextTrails']['depthTexture'];}},'vertexShaderSource':new Cesium$4[(_0x12eabc(0x1ee))]({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4[(_0x12eabc(0x1ee))]({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[screenDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':![]},'depthMask':!![],'blending':{'enabled':!![]}}),'framebuffer':undefined})};}}var getWind_frag='//\x20the\x20size\x20of\x20UV\x20textures:\x20width\x20=\x20lon,\x20height\x20=\x20lat*lev\x0auniform\x20sampler2D\x20U;\x20//\x20eastward\x20wind\x0auniform\x20sampler2D\x20V;\x20//\x20northward\x20wind\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0a\x0auniform\x20vec3\x20dimension;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20vec3\x20minimum;\x20//\x20minimum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20maximum;\x20//\x20maximum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20interval;\x20//\x20interval\x20of\x20each\x20dimension\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20mapPositionToNormalizedIndex2D(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20range\x20of\x20longitude\x20and\x20latitude\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x,\x20360.0);\x0a\x20\x20\x20\x20lonLatLev.y\x20=\x20clamp(lonLatLev.y,\x20-90.0,\x2090.0);\x0a\x0a\x20\x20\x20\x20vec3\x20index3D\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20index3D.x\x20=\x20(lonLatLev.x\x20-\x20minimum.x)\x20/\x20interval.x;\x0a\x20\x20\x20\x20index3D.y\x20=\x20(lonLatLev.y\x20-\x20minimum.y)\x20/\x20interval.y;\x0a\x20\x20\x20\x20index3D.z\x20=\x20(lonLatLev.z\x20-\x20minimum.z)\x20/\x20interval.z;\x0a\x0a\x20\x20\x20\x20//\x20the\x20st\x20texture\x20coordinate\x20corresponding\x20to\x20(col,\x20row)\x20index\x0a\x20\x20\x20\x20//\x20example\x0a\x20\x20\x20\x20//\x20data\x20array\x20is\x20[0,\x201,\x202,\x203,\x204,\x205],\x20width\x20=\x203,\x20height\x20=\x202\x0a\x20\x20\x20\x20//\x20the\x20content\x20of\x20texture\x20will\x20be\x0a\x20\x20\x20\x20//\x20t\x201.0\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x203\x204\x205\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x200\x201\x202\x0a\x20\x20\x20\x20//\x20\x20\x200.0------1.0\x20s\x0a\x0a\x20\x20\x20\x20vec2\x20index2D\x20=\x20vec2(index3D.x,\x20index3D.z\x20*\x20dimension.y\x20+\x20index3D.y);\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20vec2(index2D.x\x20/\x20dimension.x,\x20index2D.y\x20/\x20(dimension.y\x20*\x20dimension.z));\x0a\x20\x20\x20\x20return\x20normalizedIndex2D;\x0a}\x0a\x0afloat\x20getWind(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20mapPositionToNormalizedIndex2D(lonLatLev);\x0a\x20\x20\x20\x20float\x20result\x20=\x20texture(windTexture,\x20normalizedIndex2D).r;\x0a\x20\x20\x20\x20return\x20result;\x0a}\x0a\x0aconst\x20mat4\x20kernelMatrix\x20=\x20mat4(\x0a\x20\x20\x20\x200.0,\x20-1.0,\x202.0,\x20-1.0,\x20//\x20first\x20column\x0a\x20\x20\x20\x202.0,\x200.0,\x20-5.0,\x203.0,\x20//\x20second\x20column\x0a\x20\x20\x20\x200.0,\x201.0,\x204.0,\x20-3.0,\x20//\x20third\x20column\x0a\x20\x20\x20\x200.0,\x200.0,\x20-1.0,\x201.0\x20//\x20fourth\x20column\x0a);\x0afloat\x20oneDimensionInterpolation(float\x20t,\x20float\x20p0,\x20float\x20p1,\x20float\x20p2,\x20float\x20p3)\x20{\x0a\x20\x20\x20\x20vec4\x20tVec4\x20=\x20vec4(1.0,\x20t,\x20t\x20*\x20t,\x20t\x20*\x20t\x20*\x20t);\x0a\x20\x20\x20\x20tVec4\x20=\x20tVec4\x20/\x202.0;\x0a\x20\x20\x20\x20vec4\x20pVec4\x20=\x20vec4(p0,\x20p1,\x20p2,\x20p3);\x0a\x20\x20\x20\x20return\x20dot((tVec4\x20*\x20kernelMatrix),\x20pVec4);\x0a}\x0a\x0afloat\x20calculateB(sampler2D\x20windTexture,\x20float\x20t,\x20float\x20lon,\x20float\x20lat,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20float\x20lon0\x20=\x20floor(lon)\x20-\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon1\x20=\x20floor(lon);\x0a\x20\x20\x20\x20float\x20lon2\x20=\x20floor(lon)\x20+\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon3\x20=\x20floor(lon)\x20+\x202.0\x20*\x20interval.x;\x0a\x0a\x20\x20\x20\x20float\x20p0\x20=\x20getWind(windTexture,\x20vec3(lon0,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p1\x20=\x20getWind(windTexture,\x20vec3(lon1,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p2\x20=\x20getWind(windTexture,\x20vec3(lon2,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p3\x20=\x20getWind(windTexture,\x20vec3(lon3,\x20lat,\x20lev));\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(t,\x20p0,\x20p1,\x20p2,\x20p3);\x0a}\x0a\x0afloat\x20interpolateOneTexture(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20float\x20lon\x20=\x20lonLatLev.x;\x0a\x20\x20\x20\x20float\x20lat\x20=\x20lonLatLev.y;\x0a\x20\x20\x20\x20float\x20lev\x20=\x20lonLatLev.z;\x0a\x0a\x20\x20\x20\x20float\x20lat0\x20=\x20floor(lat)\x20-\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat1\x20=\x20floor(lat);\x0a\x20\x20\x20\x20float\x20lat2\x20=\x20floor(lat)\x20+\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat3\x20=\x20floor(lat)\x20+\x202.0\x20*\x20interval.y;\x0a\x0a\x20\x20\x20\x20vec2\x20coefficient\x20=\x20lonLatLev.xy\x20-\x20floor(lonLatLev.xy);\x0a\x20\x20\x20\x20float\x20b0\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat0,\x20lev);\x0a\x20\x20\x20\x20float\x20b1\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat1,\x20lev);\x0a\x20\x20\x20\x20float\x20b2\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat2,\x20lev);\x0a\x20\x20\x20\x20float\x20b3\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat3,\x20lev);\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(coefficient.y,\x20b0,\x20b1,\x20b2,\x20b3);\x0a}\x0a\x0avec3\x20bicubic(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20https://en.wikipedia.org/wiki/Bicubic_interpolation#Bicubic_convolution_algorithm\x0a\x20\x20\x20\x20float\x20u\x20=\x20interpolateOneTexture(U,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20v\x20=\x20interpolateOneTexture(V,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20return\x20vec3(u,\x20v,\x20w);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20bicubic(lonLatLev);\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(windVector,\x200.0);\x0a}\x0a',updateSpeed_frag='uniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0auniform\x20sampler2D\x20particlesWind;\x0a\x0a//\x20used\x20to\x20calculate\x20the\x20wind\x20norm\x0auniform\x20vec2\x20uSpeedRange;\x20//\x20(min,\x20max);\x0auniform\x20vec2\x20vSpeedRange;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20speedFactor;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0afloat\x20calculateWindNorm(vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec3\x20percent\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20percent.x\x20=\x20(speed.x\x20-\x20uSpeedRange.x)\x20/\x20(uSpeedRange.y\x20-\x20uSpeedRange.x);\x0a\x20\x20\x20\x20percent.y\x20=\x20(speed.y\x20-\x20vSpeedRange.x)\x20/\x20(vSpeedRange.y\x20-\x20vSpeedRange.x);\x0a\x20\x20\x20\x20float\x20normalization\x20=\x20length(percent);\x0a\x0a\x20\x20\x20\x20return\x20normalization;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20//\x20vec3\x20currentSpeed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20texture(particlesWind,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20vec4(speedFactor\x20*\x20pixelSize\x20*\x20windVector,\x20calculateWindNorm(windVector));\x0a\x20\x20\x20\x20out_FragColor\x20=\x20nextSpeed;\x0a}\x0a',updatePosition_frag=_0x230669(0x1e7),postProcessingPosition_frag='uniform\x20sampler2D\x20nextParticlesPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0a//\x20range\x20(min,\x20max)\x0auniform\x20vec2\x20lonRange;\x0auniform\x20vec2\x20latRange;\x0a\x0auniform\x20float\x20randomCoefficient;\x20//\x20use\x20to\x20improve\x20the\x20pseudo-random\x20generator\x0auniform\x20float\x20dropRate;\x20//\x20drop\x20rate\x20is\x20a\x20chance\x20a\x20particle\x20will\x20restart\x20at\x20random\x20position\x20to\x20avoid\x20degeneration\x0auniform\x20float\x20dropRateBump;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0a//\x20pseudo-random\x20generator\x0aconst\x20vec3\x20randomConstants\x20=\x20vec3(12.9898,\x2078.233,\x204375.85453);\x0aconst\x20vec2\x20normalRange\x20=\x20vec2(0.0,\x201.0);\x0afloat\x20rand(vec2\x20seed,\x20vec2\x20range)\x20{\x0a\x20\x20\x20\x20vec2\x20randomSeed\x20=\x20randomCoefficient\x20*\x20seed;\x0a\x20\x20\x20\x20float\x20temp\x20=\x20dot(randomConstants.xy,\x20randomSeed);\x0a\x20\x20\x20\x20temp\x20=\x20fract(sin(temp)\x20*\x20(randomConstants.z\x20+\x20temp));\x0a\x20\x20\x20\x20return\x20temp\x20*\x20(range.y\x20-\x20range.x)\x20+\x20range.x;\x0a}\x0a\x0avec3\x20generateRandomParticle(vec2\x20seed,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20longitude\x20is\x20in\x20[0,\x20360]\x0a\x20\x20\x20\x20float\x20randomLon\x20=\x20mod(rand(seed,\x20lonRange),\x20360.0);\x0a\x20\x20\x20\x20float\x20randomLat\x20=\x20rand(-seed,\x20latRange);\x0a\x0a\x20\x20\x20\x20return\x20vec3(randomLon,\x20randomLat,\x20lev);\x0a}\x0a\x0abool\x20particleOutbound(vec3\x20particle)\x20{\x0a\x20\x20\x20\x20return\x20particle.y\x20<\x20-90.0\x20||\x20particle.y\x20>\x2090.0;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20texture(nextParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20float\x20particleDropRate\x20=\x20dropRate\x20+\x20dropRateBump\x20*\x20nextSpeed.a;\x0a\x0a\x20\x20\x20\x20vec2\x20seed1\x20=\x20nextParticle.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec2\x20seed2\x20=\x20nextSpeed.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec3\x20randomParticle\x20=\x20generateRandomParticle(seed1,\x20nextParticle.z);\x0a\x20\x20\x20\x20float\x20randomNumber\x20=\x20rand(seed2,\x20normalRange);\x0a\x0a\x20\x20\x20\x20if\x20(randomNumber\x20<\x20particleDropRate\x20||\x20particleOutbound(nextParticle))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(randomParticle,\x201.0);\x20//\x201.0\x20means\x20this\x20is\x20a\x20random\x20particle\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a\x20\x20\x20\x20}\x0a}\x0a',postProcessingSpeed_frag=_0x230669(0x287);const Cesium$3=mars3d__namespace['Cesium'];class ParticlesComputing{constructor(_0x31996d,_0x1e5d9a,_0x3b98f6,_0x289142){const _0x5d0484=_0x230669;this['data']=_0x1e5d9a,this['createWindTextures'](_0x31996d,_0x1e5d9a),this[_0x5d0484(0x19c)](_0x31996d,_0x3b98f6,_0x289142),this['createComputingPrimitives'](_0x1e5d9a,_0x3b98f6,_0x289142);}[_0x230669(0x25a)](_0x59d229,_0x49bd1c){const _0x152381=_0x230669,_0xf02139={'context':_0x59d229,'width':_0x49bd1c['dimensions']['lon'],'height':_0x49bd1c['dimensions']['lat']*(_0x49bd1c['dimensions'][_0x152381(0x1f6)]||0x1),'pixelFormat':Cesium$3['PixelFormat'][_0x152381(0x252)],'pixelDatatype':Cesium$3[_0x152381(0x1cc)]['FLOAT'],'flipY':![],'sampler':new Cesium$3[(_0x152381(0x229))]({'minificationFilter':Cesium$3['TextureMinificationFilter']['NEAREST'],'magnificationFilter':Cesium$3[_0x152381(0x1cb)]['NEAREST']})};this['windTextures']={'U':Util['createTexture'](_0xf02139,_0x49bd1c['U']['array']),'V':Util[_0x152381(0x28a)](_0xf02139,_0x49bd1c['V'][_0x152381(0x28c)])};}[_0x230669(0x19c)](_0x228487,_0x5b26c6,_0x12685e){const _0x21967f=_0x230669,_0x1c5dad={'context':_0x228487,'width':_0x5b26c6[_0x21967f(0x233)],'height':_0x5b26c6['particlesTextureSize'],'pixelFormat':Cesium$3['PixelFormat']['RGBA'],'pixelDatatype':Cesium$3['PixelDatatype'][_0x21967f(0x290)],'flipY':![],'sampler':new Cesium$3[(_0x21967f(0x229))]({'minificationFilter':Cesium$3['TextureMinificationFilter']['NEAREST'],'magnificationFilter':Cesium$3['TextureMagnificationFilter']['NEAREST']})},_0x57a707=this[_0x21967f(0x215)](_0x5b26c6['maxParticles'],_0x12685e),_0x3002e0=new Float32Array(0x4*_0x5b26c6['maxParticles'])['fill'](0x0);this['particlesTextures']={'particlesWind':Util[_0x21967f(0x28a)](_0x1c5dad),'currentParticlesPosition':Util[_0x21967f(0x28a)](_0x1c5dad,_0x57a707),'nextParticlesPosition':Util['createTexture'](_0x1c5dad,_0x57a707),'currentParticlesSpeed':Util['createTexture'](_0x1c5dad,_0x3002e0),'nextParticlesSpeed':Util['createTexture'](_0x1c5dad,_0x3002e0),'postProcessingPosition':Util['createTexture'](_0x1c5dad,_0x57a707),'postProcessingSpeed':Util[_0x21967f(0x28a)](_0x1c5dad,_0x3002e0)};}['randomizeParticles'](_0x5ed03a,_0x4ad684){const _0x34962b=_0x230669,_0x2af736=new Float32Array(0x4*_0x5ed03a);for(let _0x19dbb3=0x0;_0x19dbb3<_0x5ed03a;_0x19dbb3++){_0x2af736[0x4*_0x19dbb3]=Cesium$3['Math']['randomBetween'](_0x4ad684['lonRange']['x'],_0x4ad684['lonRange']['y']),_0x2af736[0x4*_0x19dbb3+0x1]=Cesium$3['Math']['randomBetween'](_0x4ad684[_0x34962b(0x1a0)]['x'],_0x4ad684[_0x34962b(0x1a0)]['y']),_0x2af736[0x4*_0x19dbb3+0x2]=Cesium$3['Math'][_0x34962b(0x1e5)](this['data']['lev']['min'],this[_0x34962b(0x25b)]['lev'][_0x34962b(0x1be)]),_0x2af736[0x4*_0x19dbb3+0x3]=0x0;}return _0x2af736;}['destroyParticlesTextures'](){Object['keys'](this['particlesTextures'])['forEach'](_0x191e53=>{const _0x43b63d=_0x55d6;this['particlesTextures'][_0x191e53][_0x43b63d(0x1bf)]();});}['createComputingPrimitives'](_0x18cee2,_0x5d532c,_0x47ebc4){const _0x1a3a39=_0x230669,_0x502a79=new Cesium$3['Cartesian3'](_0x18cee2[_0x1a3a39(0x259)][_0x1a3a39(0x1c5)],_0x18cee2['dimensions']['lat'],_0x18cee2[_0x1a3a39(0x259)]['lev']),_0x32c767=new Cesium$3['Cartesian3'](_0x18cee2[_0x1a3a39(0x1c5)][_0x1a3a39(0x205)],_0x18cee2['lat'][_0x1a3a39(0x205)],_0x18cee2['lev'][_0x1a3a39(0x205)]),_0x726811=new Cesium$3['Cartesian3'](_0x18cee2['lon'][_0x1a3a39(0x1be)],_0x18cee2[_0x1a3a39(0x209)]['max'],_0x18cee2['lev']['max']),_0x524c83=new Cesium$3[(_0x1a3a39(0x20e))]((_0x726811['x']-_0x32c767['x'])/(_0x502a79['x']-0x1),(_0x726811['y']-_0x32c767['y'])/(_0x502a79['y']-0x1),_0x502a79['z']>0x1?(_0x726811['z']-_0x32c767['z'])/(_0x502a79['z']-0x1):0x1),_0x403f2b=new Cesium$3['Cartesian2'](_0x18cee2['U']['min'],_0x18cee2['U']['max']),_0x243811=new Cesium$3[(_0x1a3a39(0x238))](_0x18cee2['V']['min'],_0x18cee2['V']['max']),_0x41efd5=this;this['primitives']={'getWind':new CustomPrimitive({'commandType':'Compute','uniformMap':{'U':function(){return _0x41efd5['windTextures']['U'];},'V':function(){return _0x41efd5['windTextures']['V'];},'currentParticlesPosition':function(){return _0x41efd5['particlesTextures']['currentParticlesPosition'];},'dimension':function(){return _0x502a79;},'minimum':function(){return _0x32c767;},'maximum':function(){return _0x726811;},'interval':function(){return _0x524c83;}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[getWind_frag]}),'outputTexture':this[_0x1a3a39(0x291)]['particlesWind'],'preExecute':function(){_0x41efd5['primitives']['getWind']['commandToExecute']['outputTexture']=_0x41efd5['particlesTextures']['particlesWind'];}}),'updateSpeed':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesSpeed':function(){const _0x465a8a=_0x1a3a39;return _0x41efd5[_0x465a8a(0x291)]['currentParticlesSpeed'];},'particlesWind':function(){const _0x167c3b=_0x1a3a39;return _0x41efd5['particlesTextures'][_0x167c3b(0x25d)];},'uSpeedRange':function(){return _0x403f2b;},'vSpeedRange':function(){return _0x243811;},'pixelSize':function(){return _0x47ebc4['pixelSize'];},'speedFactor':function(){return _0x5d532c['speedFactor'];}},'fragmentShaderSource':new Cesium$3[(_0x1a3a39(0x1ee))]({'sources':[updateSpeed_frag]}),'outputTexture':this['particlesTextures'][_0x1a3a39(0x1c3)],'preExecute':function(){const _0x348e3d=_0x1a3a39,_0x2b79af=_0x41efd5['particlesTextures']['currentParticlesSpeed'];_0x41efd5['particlesTextures']['currentParticlesSpeed']=_0x41efd5['particlesTextures']['postProcessingSpeed'],_0x41efd5[_0x348e3d(0x291)][_0x348e3d(0x221)]=_0x2b79af,_0x41efd5['primitives']['updateSpeed'][_0x348e3d(0x27e)]['outputTexture']=_0x41efd5['particlesTextures'][_0x348e3d(0x1c3)];}}),'updatePosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesPosition':function(){const _0xcc8d2d=_0x1a3a39;return _0x41efd5['particlesTextures'][_0xcc8d2d(0x1e3)];},'currentParticlesSpeed':function(){return _0x41efd5['particlesTextures']['currentParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updatePosition_frag]}),'outputTexture':this['particlesTextures'][_0x1a3a39(0x231)],'preExecute':function(){const _0x944cfa=_0x1a3a39,_0x1ca832=_0x41efd5[_0x944cfa(0x291)][_0x944cfa(0x1e3)];_0x41efd5['particlesTextures']['currentParticlesPosition']=_0x41efd5[_0x944cfa(0x291)][_0x944cfa(0x234)],_0x41efd5[_0x944cfa(0x291)]['postProcessingPosition']=_0x1ca832,_0x41efd5[_0x944cfa(0x214)]['updatePosition']['commandToExecute'][_0x944cfa(0x1d1)]=_0x41efd5[_0x944cfa(0x291)]['nextParticlesPosition'];}}),'postProcessingPosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'nextParticlesPosition':function(){const _0x4fd721=_0x1a3a39;return _0x41efd5[_0x4fd721(0x291)]['nextParticlesPosition'];},'nextParticlesSpeed':function(){return _0x41efd5['particlesTextures']['nextParticlesSpeed'];},'lonRange':function(){const _0x101579=_0x1a3a39;return _0x47ebc4[_0x101579(0x248)];},'latRange':function(){return _0x47ebc4['latRange'];},'randomCoefficient':function(){const _0x2b2ebf=Math['random']();return _0x2b2ebf;},'dropRate':function(){return _0x5d532c['dropRate'];},'dropRateBump':function(){const _0x45477a=_0x1a3a39;return _0x5d532c[_0x45477a(0x242)];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[postProcessingPosition_frag]}),'outputTexture':this[_0x1a3a39(0x291)]['postProcessingPosition'],'preExecute':function(){const _0x228e76=_0x1a3a39;_0x41efd5['primitives']['postProcessingPosition']['commandToExecute']['outputTexture']=_0x41efd5['particlesTextures'][_0x228e76(0x234)];}}),'postProcessingSpeed':new CustomPrimitive({'commandType':_0x1a3a39(0x203),'uniformMap':{'postProcessingPosition':function(){const _0x4f687b=_0x1a3a39;return _0x41efd5[_0x4f687b(0x291)]['postProcessingPosition'];},'nextParticlesSpeed':function(){const _0x42d473=_0x1a3a39;return _0x41efd5[_0x42d473(0x291)]['nextParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[postProcessingSpeed_frag]}),'outputTexture':this['particlesTextures']['postProcessingSpeed'],'preExecute':function(){const _0x5cd4e5=_0x1a3a39;_0x41efd5['primitives']['postProcessingSpeed']['commandToExecute'][_0x5cd4e5(0x1d1)]=_0x41efd5[_0x5cd4e5(0x291)][_0x5cd4e5(0x221)];}})};}}const Cesium$2=mars3d__namespace['Cesium'];class ParticleSystem{constructor(_0x49e07c,_0x298a91,_0x3541c9,_0x21af65){const _0x34d73e=_0x230669;this['context']=_0x49e07c,_0x298a91={..._0x298a91},_0x298a91['udata']&&_0x298a91['vdata']&&(_0x298a91['dimensions']={},_0x298a91['dimensions']['lon']=_0x298a91['cols'],_0x298a91[_0x34d73e(0x259)]['lat']=_0x298a91['rows'],_0x298a91['dimensions']['lev']=_0x298a91['lev']||0x1,_0x298a91[_0x34d73e(0x1c5)]={},_0x298a91['lon']['min']=_0x298a91['xmin'],_0x298a91['lon'][_0x34d73e(0x1be)]=_0x298a91['xmax'],_0x298a91[_0x34d73e(0x209)]={},_0x298a91['lat'][_0x34d73e(0x205)]=_0x298a91[_0x34d73e(0x219)],_0x298a91['lat']['max']=_0x298a91['ymax'],_0x298a91['lev']={},_0x298a91[_0x34d73e(0x1f6)][_0x34d73e(0x205)]=_0x298a91['levmin']??0x1,_0x298a91[_0x34d73e(0x1f6)][_0x34d73e(0x1be)]=_0x298a91['levmax']??0x1,_0x298a91['U']={},_0x298a91['U'][_0x34d73e(0x28c)]=new Float32Array(_0x298a91['udata']),_0x298a91['U']['min']=_0x298a91[_0x34d73e(0x1de)]??Math['min'](..._0x298a91['udata']),_0x298a91['U']['max']=_0x298a91[_0x34d73e(0x264)]??Math[_0x34d73e(0x1be)](..._0x298a91[_0x34d73e(0x26a)]),_0x298a91['V']={},_0x298a91['V']['array']=new Float32Array(_0x298a91[_0x34d73e(0x27b)]),_0x298a91['V']['min']=_0x298a91[_0x34d73e(0x1b6)]??Math[_0x34d73e(0x205)](..._0x298a91[_0x34d73e(0x27b)]),_0x298a91['V']['max']=_0x298a91['vmax']??Math['max'](..._0x298a91['vdata'])),this[_0x34d73e(0x25b)]=_0x298a91,this['options']=_0x3541c9,this[_0x34d73e(0x288)]=_0x21af65,this['particlesComputing']=new ParticlesComputing(this[_0x34d73e(0x1aa)],this['data'],this['options'],this[_0x34d73e(0x288)]),this['particlesRendering']=new ParticlesRendering(this[_0x34d73e(0x1aa)],this['data'],this['options'],this['viewerParameters'],this[_0x34d73e(0x1d5)]);}[_0x230669(0x1df)](_0x432f0f){const _0x1e731f=_0x230669;this['particlesComputing']['destroyParticlesTextures'](),Object['keys'](this['particlesComputing']['windTextures'])['forEach'](_0x2659e5=>{this['particlesComputing']['windTextures'][_0x2659e5]['destroy']();}),this['particlesRendering']['textures']['colorTable']['destroy'](),Object[_0x1e731f(0x202)](this['particlesRendering']['framebuffers'])[_0x1e731f(0x26d)](_0x5e878a=>{const _0x275b4a=_0x1e731f;this['particlesRendering'][_0x275b4a(0x27d)][_0x5e878a]['destroy']();}),this['context']=_0x432f0f,this[_0x1e731f(0x1d5)]=new ParticlesComputing(this['context'],this[_0x1e731f(0x25b)],this['options'],this['viewerParameters']),this[_0x1e731f(0x1fe)]=new ParticlesRendering(this['context'],this['data'],this['options'],this['viewerParameters'],this['particlesComputing']);}['clearFramebuffers'](){const _0x5c52b8=_0x230669,_0xed0ca3=new Cesium$2['ClearCommand']({'color':new Cesium$2[(_0x5c52b8(0x1ec))](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':undefined,'pass':Cesium$2['Pass']['OPAQUE']});Object['keys'](this['particlesRendering']['framebuffers'])['forEach'](_0x37ff4c=>{const _0x5a5696=_0x5c52b8;_0xed0ca3['framebuffer']=this['particlesRendering'][_0x5a5696(0x27d)][_0x37ff4c],_0xed0ca3['execute'](this['context']);});}['refreshParticles'](_0x27f95b){const _0x280feb=_0x230669;this['clearFramebuffers'](),this['particlesComputing']['destroyParticlesTextures'](),this['particlesComputing'][_0x280feb(0x19c)](this['context'],this[_0x280feb(0x222)],this[_0x280feb(0x288)]);if(_0x27f95b){var _0x45a7e6;const _0x8aa69a=this['particlesRendering']['createSegmentsGeometry'](this[_0x280feb(0x222)]);this[_0x280feb(0x1fe)]['primitives']['segments']['geometry']=_0x8aa69a;const _0x4ccd1c=Cesium$2['VertexArray']['fromGeometry']({'context':this[_0x280feb(0x1aa)],'geometry':_0x8aa69a,'attributeLocations':this[_0x280feb(0x1fe)]['primitives'][_0x280feb(0x28b)]['attributeLocations'],'bufferUsage':Cesium$2[_0x280feb(0x22a)]['STATIC_DRAW']});(_0x45a7e6=this[_0x280feb(0x1fe)]['primitives'])!==null&&_0x45a7e6!==void 0x0&&(_0x45a7e6=_0x45a7e6['segments'])!==null&&_0x45a7e6!==void 0x0&&_0x45a7e6['commandToExecute']&&(this['particlesRendering']['primitives']['segments']['commandToExecute']['vertexArray']=_0x4ccd1c);}}['setOptions'](_0x339010){let _0x246fbb=![];this['options']['maxParticles']!==_0x339010['maxParticles']&&(_0x246fbb=!![]),Object['keys'](_0x339010)['forEach'](_0xb624f6=>{this['options'][_0xb624f6]=_0x339010[_0xb624f6];}),this['refreshParticles'](_0x246fbb);}[_0x230669(0x21c)](_0x310063){Object['keys'](_0x310063)['forEach'](_0x404ae5=>{const _0x20ccf2=_0x55d6;this[_0x20ccf2(0x288)][_0x404ae5]=_0x310063[_0x404ae5];}),this['refreshParticles'](![]);}['destroy'](){const _0x7c61ab=_0x230669;clearTimeout(this['canrefresh']),this['particlesComputing'][_0x7c61ab(0x27f)](),Object['keys'](this['particlesComputing']['windTextures'])['forEach'](_0x5429e5=>{this['particlesComputing']['windTextures'][_0x5429e5]['destroy']();}),this['particlesRendering'][_0x7c61ab(0x22f)]['colorTable']['destroy'](),Object['keys'](this['particlesRendering']['framebuffers'])[_0x7c61ab(0x26d)](_0x2ba8c7=>{this['particlesRendering']['framebuffers'][_0x2ba8c7]['destroy']();});for(const _0x23877a in this){delete this[_0x23877a];}}}const Cesium$1=mars3d__namespace['Cesium'],BaseLayer$1=mars3d__namespace[_0x230669(0x286)]['BaseLayer'],DEF_OPTIONS={'particlesNumber':0x1000,'fixedHeight':0x0,'fadeOpacity':0.996,'dropRate':0.003,'dropRateBump':0.01,'speedFactor':0.5,'lineWidth':0x2,'colors':['rgb(206,255,255)']};class WindLayer extends BaseLayer$1{constructor(_0x16f6a8={}){_0x16f6a8={...DEF_OPTIONS,..._0x16f6a8},super(_0x16f6a8),this['_setOptionsHook'](_0x16f6a8);}get['layer'](){return this['primitives'];}get['data'](){const _0x9dbf75=_0x230669;return this[_0x9dbf75(0x263)];}set['data'](_0x257e01){this['setData'](_0x257e01);}get['colors'](){return this['options']['colors'];}set['colors'](_0x3da365){const _0x136b4b=_0x230669;this['options'][_0x136b4b(0x1b5)]=_0x3da365,this[_0x136b4b(0x24e)]&&this['particleSystem']['setOptions']({'colors':_0x3da365}),this['resize']();}['_mountedHook'](){}['_addedHook'](){const _0x3af1f2=_0x230669;this['scene']=this['_map']['scene'],this['camera']=this['_map']['camera'],this['primitives']=new Cesium$1[(_0x3af1f2(0x284))](),this['_map'][_0x3af1f2(0x22e)]['primitives'][_0x3af1f2(0x244)](this[_0x3af1f2(0x214)]),this['viewerParameters']={'lonRange':new Cesium$1['Cartesian2'](),'latRange':new Cesium$1['Cartesian2'](),'pixelSize':0x0},this['globeBoundingSphere']=new Cesium$1[(_0x3af1f2(0x20b))](Cesium$1['Cartesian3'][_0x3af1f2(0x247)],0.99*0x615299),this['updateViewerParameters'](),window['addEventListener'](_0x3af1f2(0x210),this[_0x3af1f2(0x210)]['bind'](this),![]),this['mouse_down']=![],this['mouse_move']=![],this['_map']['on'](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseUp'],this['_onMouseUpEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseMove'],this[_0x3af1f2(0x280)],this),this[_0x3af1f2(0x263)]&&this[_0x3af1f2(0x1af)](this['_data']);}[_0x230669(0x1a8)](){const _0x2e79b7=_0x230669;window['removeEventListener']('resize',this['resize']),this['_map']['off'](mars3d__namespace['EventType'][_0x2e79b7(0x1bc)],this[_0x2e79b7(0x1c6)],this),this['_map']['off'](mars3d__namespace['EventType'][_0x2e79b7(0x257)],this['_onMapWhellEvent'],this),this[_0x2e79b7(0x1cd)]['off'](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['off'](mars3d__namespace[_0x2e79b7(0x224)]['mouseUp'],this['_onMouseUpEvent'],this),this[_0x2e79b7(0x1cd)][_0x2e79b7(0x1e9)](mars3d__namespace[_0x2e79b7(0x224)]['mouseMove'],this['_onMouseMoveEvent'],this),this['primitives']['removeAll'](),this['_map']['scene']['primitives'][_0x2e79b7(0x253)](this['primitives']);}[_0x230669(0x210)](){const _0x4613a8=_0x230669;if(!this['show']||!this['particleSystem'])return;this['primitives']['show']=![],this['primitives']['removeAll'](),this['_map'][_0x4613a8(0x236)](mars3d__namespace['EventType'][_0x4613a8(0x1bc)],this['_onMap_preRenderEvent'],this);}[_0x230669(0x1c6)](_0x2d19e5){const _0x22050b=_0x230669;this['particleSystem']['canvasResize'](this['scene']['context']),this['addPrimitives'](),this[_0x22050b(0x214)]['show']=!![];}['_onMapWhellEvent'](_0x24435a){const _0x1c6a97=_0x230669;clearTimeout(this['refreshTimer']);if(!this[_0x1c6a97(0x1f1)]||!this['particleSystem'])return;this['primitives']['show']=![],this[_0x1c6a97(0x19d)]=setTimeout(()=>{const _0x2fdacb=_0x1c6a97;if(!this[_0x2fdacb(0x1f1)])return;this['redraw']();},0xc8);}[_0x230669(0x199)](_0x552812){this['mouse_down']=!![];}['_onMouseMoveEvent'](_0x4278e4){const _0xba2a2f=_0x230669;if(!this[_0xba2a2f(0x1f1)]||!this['particleSystem'])return;this[_0xba2a2f(0x28e)]&&(this['primitives']['show']=![],this[_0xba2a2f(0x1c4)]=!![]);}['_onMouseUpEvent'](_0x3d1454){const _0x1174e6=_0x230669;if(!this[_0x1174e6(0x1f1)]||!this[_0x1174e6(0x24e)])return;this['mouse_down']&&this[_0x1174e6(0x1c4)]&&this['redraw'](),this[_0x1174e6(0x214)]['show']=!![],this['mouse_down']=![],this['mouse_move']=![];}['redraw'](){const _0x526fe8=_0x230669;if(!this['_map']||!this['show'])return;this[_0x526fe8(0x261)](),this['particleSystem'][_0x526fe8(0x21c)](this['viewerParameters']),this['primitives']['show']=!![];}['setData'](_0x5596dc){const _0x4be8f5=_0x230669;this['_data']=_0x5596dc,this['particleSystem']&&this['particleSystem'][_0x4be8f5(0x1bf)](),this['particleSystem']=new ParticleSystem(this[_0x4be8f5(0x22e)]['context'],_0x5596dc,this['getOptions'](),this['viewerParameters']),this['addPrimitives']();}['_setOptionsHook'](_0x4ccf7c,_0x1a74cf){const _0x5ad4c2=_0x230669;if(_0x4ccf7c)for(const _0x2b667d in _0x4ccf7c){this[_0x2b667d]=_0x4ccf7c[_0x2b667d];}this['particleSystem']&&this['particleSystem']['setOptions'](this[_0x5ad4c2(0x26b)]());}['getOptions'](){const _0x2d903d=_0x230669,_0x1b971e=Math[_0x2d903d(0x1f3)](Math[_0x2d903d(0x268)](this['particlesNumber']));return this['particlesNumber']=_0x1b971e*_0x1b971e,{'particlesTextureSize':_0x1b971e,'maxParticles':this['particlesNumber'],'particleHeight':this['fixedHeight'],'fadeOpacity':this['fadeOpacity'],'dropRate':this['dropRate'],'dropRateBump':this['dropRateBump'],'speedFactor':this['speedFactor'],'lineWidth':this['lineWidth'],'colors':this[_0x2d903d(0x1b5)]};}[_0x230669(0x1a6)](){const _0x9a19ae=_0x230669;this['primitives'][_0x9a19ae(0x244)](this['particleSystem']['particlesComputing'][_0x9a19ae(0x214)][_0x9a19ae(0x23a)]),this[_0x9a19ae(0x214)]['add'](this[_0x9a19ae(0x24e)][_0x9a19ae(0x1d5)][_0x9a19ae(0x214)]['updateSpeed']),this['primitives']['add'](this['particleSystem'][_0x9a19ae(0x1d5)]['primitives'][_0x9a19ae(0x1b3)]),this['primitives'][_0x9a19ae(0x244)](this['particleSystem'][_0x9a19ae(0x1d5)]['primitives']['postProcessingPosition']),this[_0x9a19ae(0x214)]['add'](this[_0x9a19ae(0x24e)]['particlesComputing']['primitives']['postProcessingSpeed']),this['primitives'][_0x9a19ae(0x244)](this['particleSystem'][_0x9a19ae(0x1fe)]['primitives']['segments']),this['primitives']['add'](this['particleSystem']['particlesRendering']['primitives']['trails']),this['primitives']['add'](this[_0x9a19ae(0x24e)]['particlesRendering'][_0x9a19ae(0x214)][_0x9a19ae(0x1ae)]);}['updateViewerParameters'](){const _0x5a519f=_0x230669;let _0xf9daff=this[_0x5a519f(0x1f7)]['computeViewRectangle'](this['scene']['globe'][_0x5a519f(0x1d3)]);if(!_0xf9daff){const _0x4d8a23=this[_0x5a519f(0x1cd)]['getExtent']();_0xf9daff=Cesium$1['Rectangle']['fromDegrees'](_0x4d8a23['xmin'],_0x4d8a23[_0x5a519f(0x219)],_0x4d8a23['xmax'],_0x4d8a23[_0x5a519f(0x276)]);}const _0x63a822=Util['viewRectangleToLonLatRange'](_0xf9daff);this[_0x5a519f(0x288)]['lonRange']['x']=_0x63a822[_0x5a519f(0x1c5)][_0x5a519f(0x205)],this[_0x5a519f(0x288)]['lonRange']['y']=_0x63a822[_0x5a519f(0x1c5)]['max'],this['viewerParameters']['latRange']['x']=_0x63a822[_0x5a519f(0x209)]['min'],this['viewerParameters']['latRange']['y']=_0x63a822['lat']['max'];const _0x48b30b=this[_0x5a519f(0x1f7)]['getPixelSize'](this['globeBoundingSphere'],this[_0x5a519f(0x22e)]['drawingBufferWidth'],this['scene']['drawingBufferHeight']);_0x48b30b>0x0&&(this['viewerParameters']['pixelSize']=_0x48b30b);}}mars3d__namespace['LayerUtil']['register']('wind',WindLayer),mars3d__namespace[_0x230669(0x286)][_0x230669(0x22c)]=WindLayer;class CanvasParticle{constructor(){const _0x29735e=_0x230669;this[_0x29735e(0x216)]=null,this['lat']=null,this[_0x29735e(0x25e)]=null,this['tlat']=null,this[_0x29735e(0x1b1)]=null,this[_0x29735e(0x23d)]=null;}['destroy'](){for(const _0x4de9c5 in this){delete this[_0x4de9c5];}}}function _0x55d6(_0x2ab7f1,_0x35212a){const _0x28dca3=_0x28dc();return _0x55d6=function(_0x55d63e,_0x5797fa){_0x55d63e=_0x55d63e-0x199;let _0x1c096e=_0x28dca3[_0x55d63e];return _0x1c096e;},_0x55d6(_0x2ab7f1,_0x35212a);}class CanvasWindField{constructor(_0x1068e2){this['setOptions'](_0x1068e2);}get[_0x230669(0x258)](){return this['_speedRate'];}set['speedRate'](_0xa20e0f){const _0x18c70a=_0x230669;this['_speedRate']=(0x64-(_0xa20e0f>0x63?0x63:_0xa20e0f))*0x64,this['_calc_speedRate']=[(this['xmax']-this['xmin'])/this[_0x18c70a(0x21b)],(this['ymax']-this[_0x18c70a(0x219)])/this['_speedRate']];}get['maxAge'](){return this['_maxAge'];}set['maxAge'](_0x46af2a){this['_maxAge']=_0x46af2a;}['setOptions'](_0x50ca1f){const _0x4ed1b9=_0x230669;this['options']=_0x50ca1f,this[_0x4ed1b9(0x241)]=_0x50ca1f['maxAge']||0x78,this[_0x4ed1b9(0x258)]=_0x50ca1f[_0x4ed1b9(0x258)]||0x32,this['particles']=[];const _0x4f60d0=_0x50ca1f[_0x4ed1b9(0x206)]||0x1000;for(let _0x166f10=0x0;_0x166f10<_0x4f60d0;_0x166f10++){const _0x76f063=this['_randomParticle'](new CanvasParticle());this['particles']['push'](_0x76f063);}}[_0x230669(0x1d6)](_0x4f4920){const _0x1bc75a=_0x230669;this['rows']=_0x4f4920['rows'],this['cols']=_0x4f4920['cols'],this['xmin']=_0x4f4920['xmin'],this[_0x1bc75a(0x1dc)]=_0x4f4920['xmax'],this['ymin']=_0x4f4920[_0x1bc75a(0x219)],this[_0x1bc75a(0x276)]=_0x4f4920[_0x1bc75a(0x276)],this['grid']=[];const _0x1b83c0=_0x4f4920[_0x1bc75a(0x26a)],_0x1f2fd2=_0x4f4920[_0x1bc75a(0x27b)];let _0x25bb60=![];_0x1b83c0[_0x1bc75a(0x1f8)]===this['rows']&&_0x1b83c0[0x0][_0x1bc75a(0x1f8)]===this['cols']&&(_0x25bb60=!![]);let _0x3ee6e3=0x0,_0x4a959f=null,_0x2ab8fa=null;for(let _0x122a1a=0x0;_0x122a1a<this['rows'];_0x122a1a++){_0x4a959f=[];for(let _0x349381=0x0;_0x349381<this['cols'];_0x349381++,_0x3ee6e3++){_0x25bb60?_0x2ab8fa=this[_0x1bc75a(0x266)](_0x1b83c0[_0x122a1a][_0x349381],_0x1f2fd2[_0x122a1a][_0x349381]):_0x2ab8fa=this[_0x1bc75a(0x266)](_0x1b83c0[_0x3ee6e3],_0x1f2fd2[_0x3ee6e3]),_0x4a959f['push'](_0x2ab8fa);}this['grid']['push'](_0x4a959f);}this[_0x1bc75a(0x222)]['reverseY']&&this[_0x1bc75a(0x1d8)][_0x1bc75a(0x227)]();}['clear'](){const _0x808ad8=_0x230669;delete this['rows'],delete this['cols'],delete this['xmin'],delete this['xmax'],delete this['ymin'],delete this[_0x808ad8(0x276)],delete this['grid'],delete this['particles'];}['toGridXY'](_0x32d030,_0x151c00){const _0x69d741=_0x230669,_0x4d0d20=(_0x32d030-this[_0x69d741(0x21e)])/(this['xmax']-this[_0x69d741(0x21e)])*(this[_0x69d741(0x273)]-0x1),_0x842897=(this['ymax']-_0x151c00)/(this['ymax']-this['ymin'])*(this[_0x69d741(0x293)]-0x1);return[_0x4d0d20,_0x842897];}['getUVByXY'](_0x2524e5,_0x1c594e){const _0x440b4d=_0x230669;if(_0x2524e5<0x0||_0x2524e5>=this['cols']||_0x1c594e>=this['rows'])return[0x0,0x0,0x0];const _0x1fef74=Math['floor'](_0x2524e5),_0x3d8334=Math['floor'](_0x1c594e);if(_0x1fef74===_0x2524e5&&_0x3d8334===_0x1c594e)return this['grid'][_0x1c594e][_0x2524e5];const _0x9222dd=_0x1fef74+0x1,_0x4f5bd9=_0x3d8334+0x1,_0x501433=this['getUVByXY'](_0x1fef74,_0x3d8334),_0x292255=this['getUVByXY'](_0x9222dd,_0x3d8334),_0x4b61e4=this['getUVByXY'](_0x1fef74,_0x4f5bd9),_0x44c85e=this[_0x440b4d(0x1fb)](_0x9222dd,_0x4f5bd9);let _0x35d8e9=null;try{_0x35d8e9=this[_0x440b4d(0x245)](_0x2524e5-_0x1fef74,_0x1c594e-_0x3d8334,_0x501433,_0x292255,_0x4b61e4,_0x44c85e);}catch(_0x4cfce8){console['log'](_0x2524e5,_0x1c594e);}return _0x35d8e9;}['_bilinearInterpolation'](_0x459ffb,_0xf3220b,_0x2b37d8,_0x30fbaa,_0x4a3e8b,_0x5acb5b){const _0x1e0236=0x1-_0x459ffb,_0x16c3b1=0x1-_0xf3220b,_0x2cd15f=_0x1e0236*_0x16c3b1,_0x4b9c1d=_0x459ffb*_0x16c3b1,_0x4de56a=_0x1e0236*_0xf3220b,_0x492a52=_0x459ffb*_0xf3220b,_0x5752f8=_0x2b37d8[0x0]*_0x2cd15f+_0x30fbaa[0x0]*_0x4b9c1d+_0x4a3e8b[0x0]*_0x4de56a+_0x5acb5b[0x0]*_0x492a52,_0x51b5d5=_0x2b37d8[0x1]*_0x2cd15f+_0x30fbaa[0x1]*_0x4b9c1d+_0x4a3e8b[0x1]*_0x4de56a+_0x5acb5b[0x1]*_0x492a52;return this['_calcUV'](_0x5752f8,_0x51b5d5);}[_0x230669(0x266)](_0x4204c8,_0x1b02a2){return[+_0x4204c8,+_0x1b02a2,Math['sqrt'](_0x4204c8*_0x4204c8+_0x1b02a2*_0x1b02a2)];}['getUVByPoint'](_0x16c842,_0x26d606){const _0x11e02b=_0x230669;if(!this[_0x11e02b(0x24d)](_0x16c842,_0x26d606))return null;const _0x332419=this['toGridXY'](_0x16c842,_0x26d606),_0x5cc1c3=this['getUVByXY'](_0x332419[0x0],_0x332419[0x1]);return _0x5cc1c3;}['isInExtent'](_0x14c3fa,_0x48848b){return _0x14c3fa>=this['xmin']&&_0x14c3fa<=this['xmax']&&_0x48848b>=this['ymin']&&_0x48848b<=this['ymax']?!![]:![];}['getRandomLatLng'](){const _0x8dd264=_0x230669,_0x49ab4d=fRandomByfloat(this['xmin'],this[_0x8dd264(0x1dc)]),_0x28308a=fRandomByfloat(this[_0x8dd264(0x219)],this['ymax']);return{'lat':_0x28308a,'lng':_0x49ab4d};}['getParticles'](){const _0x4e5298=_0x230669;let _0x8d029a,_0x333303,_0x3d807c;for(let _0x41acc4=0x0,_0x4aad89=this['particles']['length'];_0x41acc4<_0x4aad89;_0x41acc4++){let _0x1d8052=this['particles'][_0x41acc4];_0x1d8052['age']<=0x0&&(_0x1d8052=this[_0x4e5298(0x1e4)](_0x1d8052));if(_0x1d8052[_0x4e5298(0x1b1)]>0x0){const _0x599b6c=_0x1d8052['tlng'],_0x251377=_0x1d8052['tlat'];_0x3d807c=this['getUVByPoint'](_0x599b6c,_0x251377),_0x3d807c?(_0x8d029a=_0x599b6c+this['_calc_speedRate'][0x0]*_0x3d807c[0x0],_0x333303=_0x251377+this['_calc_speedRate'][0x1]*_0x3d807c[0x1],_0x1d8052['lng']=_0x599b6c,_0x1d8052['lat']=_0x251377,_0x1d8052[_0x4e5298(0x25e)]=_0x8d029a,_0x1d8052['tlat']=_0x333303,_0x1d8052['speed']=_0x3d807c[0x2],_0x1d8052['age']--):_0x1d8052[_0x4e5298(0x1b1)]=0x0;}}return this['particles'];}['_randomParticle'](_0x4700e0){const _0x337cb9=_0x230669;let _0x46fd3d,_0x34ba7f;for(let _0x3674eb=0x0;_0x3674eb<0x1e;_0x3674eb++){_0x46fd3d=this[_0x337cb9(0x285)](),_0x34ba7f=this['getUVByPoint'](_0x46fd3d['lng'],_0x46fd3d['lat']);if(_0x34ba7f&&_0x34ba7f[0x2]>0x0)break;}if(!_0x34ba7f)return _0x4700e0;const _0x449632=_0x46fd3d['lng']+this['_calc_speedRate'][0x0]*_0x34ba7f[0x0],_0x50b444=_0x46fd3d['lat']+this[_0x337cb9(0x277)][0x1]*_0x34ba7f[0x1];return _0x4700e0['lng']=_0x46fd3d['lng'],_0x4700e0['lat']=_0x46fd3d['lat'],_0x4700e0['tlng']=_0x449632,_0x4700e0['tlat']=_0x50b444,_0x4700e0[_0x337cb9(0x1b1)]=Math[_0x337cb9(0x23b)](Math[_0x337cb9(0x1a1)]()*this['maxAge']),_0x4700e0[_0x337cb9(0x23d)]=_0x34ba7f[0x2],_0x4700e0;}['destroy'](){for(const _0x5a3613 in this){delete this[_0x5a3613];}}}function fRandomByfloat(_0x4cd22c,_0x371b54){const _0x4b8935=_0x230669;return _0x4cd22c+Math[_0x4b8935(0x1a1)]()*(_0x371b54-_0x4cd22c);}const Cesium=mars3d__namespace['Cesium'],BaseLayer=mars3d__namespace['layer']['BaseLayer'];class CanvasWindLayer extends BaseLayer{constructor(_0x569183={}){const _0x271c26=_0x230669;super(_0x569183),this['_setOptionsHook'](_0x569183),this['canvas']=null,_0x569183[_0x271c26(0x1b5)]&&_0x569183['steps']&&(this['_colorRamp']=new mars3d__namespace[(_0x271c26(0x1f9))](_0x569183));}['_setOptionsHook'](_0x3ebaea,_0x489c5c){const _0x718079=_0x230669;this['frameTime']=0x3e8/(_0x3ebaea['frameRate']||0xa),this['_pointerEvents']=this[_0x718079(0x222)]['pointerEvents']??![],this[_0x718079(0x275)]=_0x3ebaea['color']||'#ffffff',this['lineWidth']=_0x3ebaea['lineWidth']||0x1,this['fixedHeight']=_0x3ebaea['fixedHeight']??0x0,this['reverseY']=_0x3ebaea['reverseY']??![],this[_0x718079(0x1e2)]&&this['windField'][_0x718079(0x1f4)](_0x3ebaea);}get['layer'](){return this['canvas'];}get['canvasWidth'](){const _0x382f75=_0x230669;return this['_map'][_0x382f75(0x22e)][_0x382f75(0x1c8)][_0x382f75(0x1d2)];}get['canvasHeight'](){return this['_map']['scene']['canvas']['clientHeight'];}get['pointerEvents'](){return this['_pointerEvents'];}set[_0x230669(0x24f)](_0x2d4daf){const _0x2f3823=_0x230669;this['_pointerEvents']=_0x2d4daf;if(!this['canvas'])return;_0x2d4daf?this['canvas']['style'][_0x2f3823(0x239)]=_0x2f3823(0x1ef):this['canvas'][_0x2f3823(0x267)][_0x2f3823(0x239)]='none';}get['particlesNumber'](){const _0xcbdabc=_0x230669;return this[_0xcbdabc(0x222)][_0xcbdabc(0x206)];}set[_0x230669(0x206)](_0x35dc73){const _0x45bf26=_0x230669;this['options'][_0x45bf26(0x206)]=_0x35dc73,clearTimeout(this['_canrefresh']),this['_canrefresh']=setTimeout(()=>{this['redraw']();},0x1f4);}get['speedRate'](){return this['options']['speedRate'];}set['speedRate'](_0x25325e){const _0x9dae9e=_0x230669;this[_0x9dae9e(0x222)]['speedRate']=_0x25325e,this['windField']&&(this[_0x9dae9e(0x1e2)][_0x9dae9e(0x258)]=_0x25325e);}get['maxAge'](){const _0x3d2c0f=_0x230669;return this['options'][_0x3d2c0f(0x241)];}set[_0x230669(0x241)](_0x39074d){this['options']['maxAge']=_0x39074d,this['windField']&&(this['windField']['maxAge']=_0x39074d);}get[_0x230669(0x25b)](){return this['windData'];}set[_0x230669(0x25b)](_0x13ccda){const _0x275c17=_0x230669;this[_0x275c17(0x1af)](_0x13ccda);}['_showHook'](_0x59e0ee){const _0x12fa42=_0x230669;_0x59e0ee?this['_addedHook']():(this['windData']&&(this['options']['data']=this[_0x12fa42(0x246)]),this['_removedHook']());}[_0x230669(0x1bd)](){this['options']['worker']?this['initWorker']():this['windField']=new CanvasWindField(this['options']);}['_addedHook'](){const _0x4bc308=_0x230669;this[_0x4bc308(0x1c8)]=this['_createCanvas'](),this['canvasContext']=this[_0x4bc308(0x1c8)]['getContext']('2d',{'willReadFrequently':!![]}),this['bindEvent'](),this['options']['data']&&this[_0x4bc308(0x1af)](this['options'][_0x4bc308(0x25b)]);}[_0x230669(0x1a8)](){const _0x2a6fff=_0x230669;this['clear'](),this['unbindEvent'](),this[_0x2a6fff(0x1c8)]&&(this[_0x2a6fff(0x1cd)]['container']['removeChild'](this['canvas']),delete this['canvas']);}[_0x230669(0x228)](){const _0x8eafc9=_0x230669,_0x55272f=mars3d__namespace['DomUtil']['create']('canvas','mars3d-canvasWind',this[_0x8eafc9(0x1cd)][_0x8eafc9(0x19e)]);return _0x55272f['style']['position']='absolute',_0x55272f[_0x8eafc9(0x267)]['top']='0px',_0x55272f['style']['left']=_0x8eafc9(0x274),_0x55272f['style']['width']=this[_0x8eafc9(0x1cd)]['scene'][_0x8eafc9(0x1c8)]['clientWidth']+'px',_0x55272f['style'][_0x8eafc9(0x1d4)]=this['_map']['scene']['canvas']['clientHeight']+'px',_0x55272f['style']['pointerEvents']=this['_pointerEvents']?'auto':'none',_0x55272f[_0x8eafc9(0x267)]['zIndex']=this[_0x8eafc9(0x222)][_0x8eafc9(0x1bb)]??0x9,_0x55272f['width']=this['_map'][_0x8eafc9(0x22e)]['canvas']['clientWidth'],_0x55272f['height']=this[_0x8eafc9(0x1cd)]['scene']['canvas']['clientHeight'],_0x55272f;}['resize'](){const _0x9d6aaa=_0x230669;this['canvas']&&(this['canvas']['style']['width']=this['_map'][_0x9d6aaa(0x22e)][_0x9d6aaa(0x1c8)]['clientWidth']+'px',this['canvas']['style'][_0x9d6aaa(0x1d4)]=this['_map']['scene'][_0x9d6aaa(0x1c8)]['clientHeight']+'px',this['canvas']['width']=this['_map']['scene']['canvas']['clientWidth'],this[_0x9d6aaa(0x1c8)][_0x9d6aaa(0x1d4)]=this['_map'][_0x9d6aaa(0x22e)]['canvas']['clientHeight']);}['bindEvent'](){const _0x6e0d53=_0x230669,_0x5cfda9=this;let _0x44bc7=Date[_0x6e0d53(0x1da)]();(function _0x46fadb(){const _0x2c9125=_0x6e0d53;_0x5cfda9['animateFrame']=window['requestAnimationFrame'](_0x46fadb);if(_0x5cfda9[_0x2c9125(0x1f1)]&&_0x5cfda9[_0x2c9125(0x1e2)]){const _0x4bf05e=Date[_0x2c9125(0x1da)](),_0x1143a9=_0x4bf05e-_0x44bc7;_0x1143a9>_0x5cfda9[_0x2c9125(0x1e0)]&&(_0x44bc7=_0x4bf05e-_0x1143a9%_0x5cfda9[_0x2c9125(0x1e0)],_0x5cfda9['update']());}}(),window[_0x6e0d53(0x26e)]('resize',this[_0x6e0d53(0x210)]['bind'](this),![]),this['mouse_down']=![],this['mouse_move']=![],this['options']['mouseHidden']&&(this['_map']['on'](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this['_map']['on'](mars3d__namespace[_0x6e0d53(0x224)]['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseUp'],this[_0x6e0d53(0x282)],this)));}['unbindEvent'](){const _0x55138a=_0x230669;window[_0x55138a(0x208)](this[_0x55138a(0x1c1)]),delete this['animateFrame'],window['removeEventListener']('resize',this['resize']),this['options'][_0x55138a(0x223)]&&(this['_map'][_0x55138a(0x1e9)](mars3d__namespace['EventType']['wheel'],this[_0x55138a(0x1c7)],this),this[_0x55138a(0x1cd)]['off'](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['off'](mars3d__namespace['EventType']['mouseUp'],this['_onMouseUpEvent'],this),this['_map']['off'](mars3d__namespace['EventType'][_0x55138a(0x262)],this[_0x55138a(0x280)],this));}['_onMapWhellEvent'](_0xb10dda){const _0x1fbcda=_0x230669;clearTimeout(this[_0x1fbcda(0x19d)]);if(!this['show']||!this['canvas'])return;this[_0x1fbcda(0x1c8)]['style']['visibility']='hidden',this['refreshTimer']=setTimeout(()=>{const _0xffb266=_0x1fbcda;if(!this[_0xffb266(0x1f1)])return;this['redraw'](),this[_0xffb266(0x1c8)][_0xffb266(0x267)]['visibility']='visible';},0xc8);}[_0x230669(0x199)](_0x2202f1){const _0xc7bf7d=_0x230669;this[_0xc7bf7d(0x28e)]=!![],this['_map']['off'](mars3d__namespace[_0xc7bf7d(0x224)][_0xc7bf7d(0x262)],this['_onMouseMoveEvent'],this),this['_map']['on'](mars3d__namespace['EventType'][_0xc7bf7d(0x262)],this[_0xc7bf7d(0x280)],this);}[_0x230669(0x280)](_0x401371){const _0x505825=_0x230669;if(!this[_0x505825(0x1f1)]||!this['canvas'])return;this['mouse_down']&&(this['canvas'][_0x505825(0x267)]['visibility']='hidden',this[_0x505825(0x1c4)]=!![]);}['_onMouseUpEvent'](_0x15482b){const _0x1bf357=_0x230669;if(!this['show']||!this[_0x1bf357(0x1c8)])return;this[_0x1bf357(0x1cd)][_0x1bf357(0x1e9)](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this),this['mouse_down']&&this['mouse_move']&&this['redraw'](),this['canvas']['style']['visibility']=_0x1bf357(0x1e1),this['mouse_down']=![],this['mouse_move']=![];}['setData'](_0x213def){const _0x5a591b=_0x230669;this['clear'](),this['windData']=_0x213def,this['windField'][_0x5a591b(0x1d6)](_0x213def),this['redraw']();}['redraw'](){if(!this['show'])return;this['windField']['setOptions'](this['options']),this['update']();}[_0x230669(0x212)](){const _0x22a98b=_0x230669;if(this[_0x22a98b(0x25f)])return;this[_0x22a98b(0x25f)]=!![];if(this['worker'])this['windField'][_0x22a98b(0x212)]();else{const _0x1250de=this[_0x22a98b(0x1e2)]['getParticles']();this['_drawLines'](_0x1250de);}this['_updateIng']=![];}['_drawLines'](_0x114fba){const _0x21bcde=_0x230669;this[_0x21bcde(0x25c)]['globalCompositeOperation']=_0x21bcde(0x1f2),this[_0x21bcde(0x25c)]['fillRect'](0x0,0x0,this['canvasWidth'],this[_0x21bcde(0x1b7)]),this['canvasContext']['globalCompositeOperation']='lighter',this[_0x21bcde(0x25c)]['globalAlpha']=0.9;const _0x35dae0=this['_map']['scene']['mode']!==Cesium['SceneMode']['SCENE3D'],_0x18b8f3=this['canvasWidth']*0.25;if(this[_0x21bcde(0x1f5)])for(let _0x2beaeb=0x0,_0x1f4081=_0x114fba['length'];_0x2beaeb<_0x1f4081;_0x2beaeb++){const _0x1755c2=_0x114fba[_0x2beaeb],_0x27b496=this['_tomap'](_0x1755c2['lng'],_0x1755c2[_0x21bcde(0x209)],_0x1755c2),_0x3a203f=this['_tomap'](_0x1755c2['tlng'],_0x1755c2['tlat'],_0x1755c2);if(!_0x27b496||!_0x3a203f)continue;if(_0x35dae0&&Math['abs'](_0x27b496[0x0]-_0x3a203f[0x0])>=_0x18b8f3)continue;this['canvasContext'][_0x21bcde(0x230)](),this['canvasContext']['lineWidth']=this[_0x21bcde(0x292)],this['canvasContext'][_0x21bcde(0x1b9)]=this['_colorRamp'][_0x21bcde(0x272)](_0x1755c2[_0x21bcde(0x23d)]),this['canvasContext'][_0x21bcde(0x1ff)](_0x27b496[0x0],_0x27b496[0x1]),this['canvasContext'][_0x21bcde(0x27a)](_0x3a203f[0x0],_0x3a203f[0x1]),this['canvasContext']['stroke']();}else{this[_0x21bcde(0x25c)][_0x21bcde(0x230)](),this[_0x21bcde(0x25c)][_0x21bcde(0x292)]=this[_0x21bcde(0x292)],this['canvasContext']['strokeStyle']=this[_0x21bcde(0x275)];for(let _0x306b57=0x0,_0x43da5e=_0x114fba[_0x21bcde(0x1f8)];_0x306b57<_0x43da5e;_0x306b57++){const _0x4bb2c3=_0x114fba[_0x306b57],_0x1b9e19=this[_0x21bcde(0x26c)](_0x4bb2c3['lng'],_0x4bb2c3[_0x21bcde(0x209)],_0x4bb2c3),_0x430e48=this['_tomap'](_0x4bb2c3[_0x21bcde(0x25e)],_0x4bb2c3['tlat'],_0x4bb2c3);if(!_0x1b9e19||!_0x430e48)continue;if(_0x35dae0&&Math['abs'](_0x1b9e19[0x0]-_0x430e48[0x0])>=_0x18b8f3)continue;this['canvasContext'][_0x21bcde(0x1ff)](_0x1b9e19[0x0],_0x1b9e19[0x1]),this['canvasContext']['lineTo'](_0x430e48[0x0],_0x430e48[0x1]);}this['canvasContext']['stroke']();}}['_tomap'](_0x48ad65,_0x3fcd5d,_0xa1a0cc){const _0xa3d9cc=_0x230669,_0x2212e1=Cesium['Cartesian3'][_0xa3d9cc(0x1c0)](_0x48ad65,_0x3fcd5d,this['fixedHeight']),_0x220f59=this['_map']['scene'];if(_0x220f59['mode']===Cesium['SceneMode'][_0xa3d9cc(0x260)]){const _0x151f6e=new Cesium[(_0xa3d9cc(0x1f0))](_0x220f59[_0xa3d9cc(0x220)]['ellipsoid'],_0x220f59['camera'][_0xa3d9cc(0x269)]),_0x325497=_0x151f6e['isPointVisible'](_0x2212e1);if(!_0x325497)return _0xa1a0cc[_0xa3d9cc(0x1b1)]=0x0,null;}const _0x2b54fc=Cesium['SceneTransforms']['wgs84ToWindowCoordinates'](this[_0xa3d9cc(0x1cd)]['scene'],_0x2212e1);return _0x2b54fc?[_0x2b54fc['x'],_0x2b54fc['y']]:null;}['clear'](){const _0x25fdb8=_0x230669;this[_0x25fdb8(0x1e2)]['clear'](),delete this[_0x25fdb8(0x246)];}['initWorker'](){const _0x319336=_0x230669;this[_0x319336(0x271)]=new Worker(this['options'][_0x319336(0x271)]),this[_0x319336(0x271)]['onmessage']=_0x2da116=>{const _0x23171e=_0x319336;this[_0x23171e(0x1a5)](_0x2da116['data']['particles']),this['_updateIng2']=![];},this['windField']={'init':_0x33bfdb=>{this['worker']['postMessage']({'type':'init','options':_0x33bfdb});},'setOptions':_0x3304e8=>{this['worker']['postMessage']({'type':'setOptions','options':_0x3304e8});},'setDate':_0x1e6fb3=>{const _0x2716af=_0x319336;this['worker'][_0x2716af(0x23c)]({'type':'setDate','data':_0x1e6fb3});},'update':()=>{const _0x479f5f=_0x319336;if(this['_updateIng2'])return;this['_updateIng2']=!![],this[_0x479f5f(0x271)]['postMessage']({'type':'update'});},'clear':()=>{const _0x4194ce=_0x319336;this['worker'][_0x4194ce(0x23c)]({'type':'clear'});}},this['windField'][_0x319336(0x1b4)](this['options']);}}mars3d__namespace[_0x230669(0x207)][_0x230669(0x204)](_0x230669(0x243),CanvasWindLayer),mars3d__namespace['layer'][_0x230669(0x225)]=CanvasWindLayer,mars3d__namespace['CanvasWindField']=CanvasWindField,mars3d__namespace['WindUtil']=WindUtil,exports['CanvasWindField']=CanvasWindField,exports['CanvasWindLayer']=CanvasWindLayer,exports['WindLayer']=WindLayer,exports['WindUtil']=WindUtil,Object[_0x230669(0x24c)](exports,_0x230669(0x1c2),{'value':!![]});
}));
